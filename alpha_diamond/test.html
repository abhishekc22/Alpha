from django.shortcuts import render, redirect
from store.models import product
from .models import cartitem,Cart
from django.conf import settings
from django.core.exceptions import ObjectDoesNotExist
from django.shortcuts import get_object_or_404
from django.contrib import messages
from django.views.decorators.http import require_POST

# Creating cart
def __cart_id(request):
    carts = request.session.session_key
    if not carts:
        carts = request.session.create()
    return carts   

# adding product in cart if it is new product  adding one by one product

def add_cart(request,product_id):
    products = product.objects.get(id=product_id)
    if request.user.is_authenticated:
        try:
            cart_instance = Cart.objects.get(user=request.user)
        except Cart.DoesNotExist:
            cart_instance = Cart.objects.create(user=request.user)
    else:
        try:
            cart_instance = Cart.objects.get(cart_id=__cart_id(request))
        except Cart.DoesNotExist:
            cart_instance = Cart.objects.create(cart_id=__cart_id(request))
    cart_instance.save()

    try:
        cart_items=cartitem.objects.get(product=products,cart=cart_instance)
        if((products.stock)-(cart_items.quandity +1))<0:
            messages.warning(request,"out of stock")
            return redirect('cart')
        cart_items.quandity += 1
        cart_items.save()
    except cartitem.DoesNotExist:
        if request.user.is_authenticated:
        
            if((products.stock)-1)<0:
                return redirect('cart')
            cart_items= cartitem.objects.create(
               product=products,
               cart=cart_instance,
               quandity=1,
               user=request.user,
            )
            cart_items.save() 
        else:
            cart_items =cartitem.objects.create(
                product=products,
                cart=cart_instance,
                quandity=1,
            )
            cart_items.save()
    return redirect('cart')


#removing cartitems fully

def remove_cart_item(request,product_id):
    # cart=Cart.objects.get(cart_id=__cart_id(request))
    # products=product.objects.get(id=product_id)
    # cart.save()
    if request.user.is_authenticated:
         cart_items=cartitem.objects.get(id=product_id,user=request.user)
    else:
        cart=Cart.objects.get(cart_id=__cart_id(request))
        cart.save()
        cart_items=cartitem.objects.get(id=product_id,cart=cart)
    cart_items.delete()
    return redirect ('cart')


#removing cart in cartitems block with one by one 

def remove_cart(request,product_id):
    # cart=Cart.objects.get(cart_id=__cart_id(request))
    products=get_object_or_404(product, id =product_id)
    # cart.save()
    if request.user.is_authenticated:   
        cart_items=cartitem.objects.get(product=products,user=request.user)

    else:
        cart=Cart.objects.get(cart_id=__cart_id(request))
        cart.save()
        cart_items=cartitem.objects.get(product=products,cart=cart)

    if cart_items.quandity>1:
        cart_items.quandity-=1
        cart_items.save()
    else:
        cart_items.delete()
    return redirect('cart')


# it will adding to the cart in cartitems in with quandity, total..etc

def cart(request,total=0,quandity=0,cart_items=None):
    try:
        if request.user.is_authenticated:
            cart_items=cartitem.objects.filter(user=request.user,is_active=True)

        else:  
            cart=Cart.objects.get(cart_id=__cart_id(request))
            cart_items=cartitem.objects.filter(cart=cart,is_active=True)
        for cart_item in cart_items:
            total+=(cart_item.product.price * cart_item.quandity)
            quandity+=cart_item.quandity

            
    except ObjectDoesNotExist:
        pass
    context={
            'total':total,
            'quandity':quandity,
            'cart_items': cart_items,
    }
    return render(request,'cart/cart.html',context)








    {% comment %}  {% endcomment %}
{% extends 'base.html' %}
{% block content%}
<main>
    <!-- Hero Area Start-->
    <div class="slider-area ">
        <div class="single-slider slider-height2 d-flex align-items-center">
            <div class="container">
                <div class="row">
                    <div class="col-xl-12">
                        <div class="hero-cap text-center">
                            <h2>Cart List</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--================Cart Area =================-->
    <section class="cart_area section_padding">
      <div class="container">
{% if not cart_items %}
<h2 class="text-center">YOUR SHOPING CART IS EMPTY</h2>
<br>
<div class="text-center">
  <a href="{% url 'product_display'%}"  class="btn btn-primary">CONTINUE SHOPING</a>
</div>
{% else %}
        <div class="cart_inner">
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th scope="col"style="color: #333;">Product</th>
                  <th scope="col"style="color: #333;">Price</th>
                  <th scope="col"style="color: #333;">Quantity</th>
                  <th scope="col"style="color: #333;">SubTotal</th>
                  <th scope="col"style="color: #333;"></th>
                </tr>
              </thead>
              <tbody>
                {% for cart_item in cart_items%}
                 <tr>
                  <td>
                    <div class="media">
                      <div class="d-flex">
                        <img src="{{ cart_item.product.image1.url}}" alt="" />
                      </div>
                      <div class="media-body">
                   <a href="{%url 'single_view' product_id=cart_item.product.id %}" ><p>{{cart_item.product.product_name}}</p></a>
                      </div>
                    </div>
                  </td>
                  <td>
                    <h5>{{cart_item.product.price}}</h5>
                  </td>
                  <td>
                    <div class="product_count">
                    
                      <span class="input-number-decrement link-like"> <a href="{% url 'remove_cart' cart_item.product.id %}"> <i class="ti-minus"></i></a></span>
                      <input class="input-number" type="text" value={{ cart_item.quandity }} >
                      <span class="input-number-increment">
                        <a href="{% url 'add_cart' cart_item.product.id %}">
                            <i class="ti-plus"></i>
                        </a>
                    </span>
                    
                    </div>
                  </td>
                  <td>
                    <h5>{{cart_item.sub_total}}</h5>
                  </td>
                  <td>
                 <a class="btn" href="{% url 'remove_cart_item' cart_item.id %}">remove</a>
                  </td> 
                 </tr>
                {% endfor %}
                <tr>
                  <td></td>
                  <td></td>
                  <td>
                    <h5 style="color: #333;">TOTAL PRICE</h5>
                  </td>
                  <td>
                    <h5style="color: #444;">{{ total }}</h5>
                  </td>
                </tr>
                </tr>
              </tbody>
            </table>
            <div class="checkout_btn_inner float-left">
              <a class="btn_1" href="{% url 'product_display' %}">Continue Shopping</a>
            </div>
            <div class="checkout_btn_inner float-right">
              <a class="btn_1 checkout_btn_1" href="{%url 'checkout' %}">Proceed to checkout</a>
            </div>
          </div>
        </div>
{% endif %}        
    </section>
{% endblock content%}

{% comment %} 





{% extends 'base.html' %}
{% block content%}
<main>
    <!-- Hero Area Start-->
    <div class="slider-area ">
        <div class="single-slider slider-height2 d-flex align-items-center">
            <div class="container">
                <div class="row">
                    <div class="col-xl-12">
                        <div class="hero-cap text-center">
                            <h2>Cart List</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--================Cart Area =================-->
    <section class="cart_area section_padding">
      <div class="container">
{% if not cart_items %}
<h2 class="text-center">YOUR SHOPING CART IS EMPTY</h2>
<br>
<div class="text-center">
  <a href="{% url 'product_display'%}"  class="btn btn-primary">CONTINUE SHOPING</a>
</div>
{% else %}
        <div class="cart_inner">
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th scope="col"style="color: #333;">Product</th>
                  <th scope="col"style="color: #333;">Price</th>
                  <th scope="col"style="color: #333;">Quantity</th>
                  <th scope="col"style="color: #333;">SubTotal</th>
                  <th scope="col"style="color: #333;"></th>
                </tr>
              </thead>
              <tbody>
                {% for cart_item in cart_items%}
                 <tr>
                  <td>
                    <div class="media">
                      <div class="d-flex">
                        <img src="{{ cart_item.product.image1.url}}" alt="" />
                      </div>
                      <div class="media-body">
                   <a href="{%url 'single_view' product_id=cart_item.product.id %}" ><p>{{cart_item.product.product_name}}</p></a>
                      </div>
                    </div>
                  </td>
                  <td>
                    <h5>{{cart_item.product.price}}</h5>
                  </td>
{% comment %} 
                   <td>
                    <div class="product_count">
                    
                      <span class="input-number-decrement link-like"> <a href="{% url 'remove_cart' cart_item.product.id %}"> <i class="ti-minus"></i></a></span>
                      <input class="input-number" type="text" value={{ cart_item.quandity }} >
                      <span class="input-number-increment">
                        <a href="{% url 'add_cart' cart_item.product.id %}">
                            <i class="ti-plus"></i>
                        </a>
                    </span>
                    
                    </div>
                  </td>  {% endcomment %}


                  <td>
                    <div class="product_count">
                        <span class="input-number-decrement link-like"
                            data-item-id="{{cart_item.id }}" data-action="reduce">
                            <i class="ti-minus"></i>
                        </span>
                        <input class="input-number" type="text" value="{{ cart_item.quantity }}" min="0"
                            max="{{cart_item.product.stock }}" data-item-id="{{ cart_item.id }}">
                        <span class="input-number-increment link-like"
                            data-item-id="{{ cart_item.id }}" data-action="add">
                            <i class="ti-plus"></i>
                        </span>
                    </div>
                </td>
                
                  <td>
                    <h5>{{cart_item.sub_total}}</h5>
                  </td>
                  <td>
                 <a class="btn" href="{% url 'remove_cart_item' cart_item.id %}">remove</a>
                  </td> 
                 </tr>
                {% endfor %}
                <tr>
                  <td></td>
                  <td></td>
                  <td>
                    <h5 style="color: #333;">TOTAL PRICE</h5>
                  </td>
                  <td>
                    <h5style="color: #444;">{{ total }}</h5>
                  </td>
                </tr>
                </tr>
              </tbody>
            </table>
            <div class="checkout_btn_inner float-left">
              <a class="btn_1" href="{% url 'product_display' %}">Continue Shopping</a>
            </div>
            <div class="checkout_btn_inner float-right">
              <a class="btn_1 checkout_btn_1" href="{%url 'checkout' %}">Proceed to checkout</a>
            </div>
          </div>
        </div>
{% endif %}        
    </section>





    {% extends 'base.html' %}
{% block content%}
<main>
    <!-- Hero Area Start-->
    <div class="slider-area ">
        <div class="single-slider slider-height2 d-flex align-items-center">
            <div class="container">
                <div class="row">
                    <div class="col-xl-12">
                        <div class="hero-cap text-center">
                            <h2>Cart List</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--================Cart Area =================-->
    <section class="cart_area section_padding">
      <div class="container">
          {% if not cart_items %}
          <h2 class="text-center">YOUR SHOPPING CART IS EMPTY</h2>
          <br>
          <div class="text-center">
              <a href="{% url 'product_display' %}" class="btn btn-primary">CONTINUE SHOPPING</a>
          </div>
          {% else %}
          <div class="cart_inner">
              <div class="table-responsive">
                  <table class="table">
                      <thead>
                          <tr>
                              <th scope="col" style="color: #333;">Product</th>
                              <th scope="col" style="color: #333;">Price</th>
                              <th scope="col" style="color: #333;">Quantity</th>
                              <th scope="col" style="color: #333;">SubTotal</th>
                              <th scope="col" style="color: #333;"></th>
                          </tr>
                      </thead>
                      <tbody>
                          {% for cart_item in cart_items %}
                          <tr data-cart-item-id="{{ cart_item.id }}" class="cart-item-row">
                              <td>
                                  <div class="media">
                                      <div class="d-flex">
                                          <img src="{{ cart_item.product.image1.url }}" alt="" />
                                      </div>
                                      <div class="media-body">
                                          <a href="{% url 'single_view' product_id=cart_item.product.id %}">
                                              <p>{{ cart_item.product.product_name }}</p>
                                          </a>
                                      </div>
                                  </div>
                              </td>
                              <td>
                                  <h5 class="product-price">{{ cart_item.variation.price }}</h5>
                              </td>
                              <td>
                                  <div class="product_count">
                                      <span class="input-number-decrement link-like" data-action="reduce">
                                          <i class="ti-minus"></i>
                                      </span>
                                      <input class="input-number" type="text" value="{{ cart_item.quandity }}" min="1"
                                          max="{{ cart_item.variation.stock }}" />
                                      <span class="input-number-increment link-like" data-action="add">
                                          <i class="ti-plus"></i>
                                      </span>
                                  </div>
                              </td>
                              <td class="item-sub-total">
                                <h5>{{ cart_item.sub_total|floatformat:"2" }}</h5>
                            </td>                            
                              <td>
                                  <a class="btn remove-cart-item"
                                      href="{% url 'remove_cart_item' cart_item.id %}">remove</a>
                              </td>
                          </tr>
                          {% endfor %}
                          <tr>
                              <td></td>
                              <td></td>
                              <td>
                                  <h5 style="color: #333;">TOTAL PRICE</h5>
                              </td>
                              <td>
                                  <h5 style="color: #444;">{{ total }}</h5>
                              </td>
                          </tr>
                      </tbody>
                  </table>
                  <div class="checkout_btn_inner float-left">
                      <a class="btn_1" href="{% url 'product_display' %}">Continue Shopping</a>
                  </div>
                  <div class="checkout_btn_inner float-right">
                      <a class="btn_1 checkout_btn_1" href="{% url 'checkout' %}">Proceed to checkout</a>
                  </div>
              </div>
          </div>
          {% endif %}
      </div>
  </section>
  
 </main>

 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
 <script>
  $(document).ready(function() {
    $('.input-number-decrement, .input-number-increment').click(function(e) {
        e.preventDefault();
        
        const action = $(this).data('action');
        const row = $(this).closest('.cart-item-row');
        const itemId = row.data('cart-item-id');
        const inputField = row.find('.input-number');
        const currentValue = parseInt(inputField.val());
        let newQuantity = currentValue;
        
       // if (action === 'reduce' && newQuantity > 1) {
       //     newQuantity--;
      //  } else if (action === 'add' && newQuantity < inputField.attr('max')) {
       //     newQuantity++;
      //  }
        
        $.ajax({
            url: '{% url "update_quantity" %}',
            type: 'POST',
            data: {
                'item_id': itemId,
                'new_quantity': newQuantity,
                'csrfmiddlewaretoken': '{{ csrf_token }}',
            },
            success: function(data) {
                if (data.success) {
                    // Update the sub-total and total for this item
                    const itemSubTotalElement = row.find('.item-sub-total');
                    itemSubTotalElement.text(data.item_sub_total.toFixed(2));  // Update with the returned value
                    
                    const cartTotalElement = $('#cart-total-value');
                    cartTotalElement.text(data.cart_total.toFixed(2));  // Update with the returned value
                } else {
                    alert('Failed to update quantity.');
                }
            },
            error: function() {
                alert('An error occurred.');
            }
        });
    });
});
</script>

{% endblock content %}











{% extends 'products/base.html' %}
{% block content %}

<style>
    .quantity-button {
        display: inline-block;
        width: 30px;
        height: 30px;
        background-color: #f1f1f1;
        color: #333;
        text-align: center;
        line-height: 30px;
        text-decoration: none;
        font-weight: bold;
      }
      
      .quantity-button:hover {
        background-color: #ddd;
      } 

      .coupon1 {
        border: 5px dotted #bbb; /* Dotted border */
        width: 80%;
        border-radius: 15px; /* Rounded border */
        margin: 0 auto; /* Center the coupon */
        max-width: 600px;
      }
      
      .container1 {
        padding: 2px 16px;
        background-color: #f1f1f1;
      }
      
      .promo1 {
        background: #ccc;
        padding: 3px;
      }
      
      .expire1 {
        color: red;
      }  
     
      .expire2 {
        color: green;
      }  
      
</style>


    <!-- ...:::: Start Breadcrumb Section:::... -->
    <div class="breadcrumb-section" style="background: linear-gradient(to bottom, #000000, #333333);">
        <div class="breadcrumb-wrapper">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <h3 class="breadcrumb-title" style="color: white;">Cart</h3>
                        
                    </div>
                </div>
            </div>
        </div>
        
    </div> <!-- ...:::: End Breadcrumb Section:::... -->
   
    <!-- ...:::: Start Cart Section:::... -->
    <div class="cart-section">
        {% include 'includes/alerts.html' %}
        {% if cart_obj and cart_obj.cart_items.exists %}
        <!-- Start Cart Table -->
        <div class="cart-table-wrapper" data-aos="fade-up" data-aos-delay="0">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="table_desc">
                            <div class="table_page table-responsive">
                                <table>
                                    <!-- Start Cart Table Head -->
                                    <thead>
                                        <tr>
                                            <th class="product_remove">Delete</th>
                                            <th class="product_thumb">Image</th>
                                            <th class="product_name">Product</th>
                                            <th class="product-price">Price</th>
                                            <th class="product_quantity">Quantity</th>
                                            <th class="product_total">Total</th>
                                        </tr>
                                    </thead> <!-- End Cart Table Head -->
                                    <tbody>
                                        {% for cart_item in cart_obj.cart_items.all %}
                                        <!-- Start Cart Single Item-->
                                        <tr>
                                            <td class="product_remove"><a href="{% url 'remove_cart' cart_item.id %}"><i class="fa fa-trash-o"></i></a>
                                            </td>
                                            <td class="product_thumb">
                                                
                                                <a href="product-details-default.html"><img src="{{ cart_item.get_product_image }}" alt=""></a>
                                                        
                                                        </td>
                                            <td class="product_name"><a href="product-details-default.html">{{ cart_item.product.name }}</a></td>


                                            {% if cart_item.product.offers.exists or cart_item.product.category.offers.exists %}
                                            {% with discounted_price=cart_item.product.discounted_price %}
                                                <td class="product-price">&#8377;{{ discounted_price|floatformat:2 }}</td>
                                            {% endwith %}
                                        {% else %}
                                            <td class="product-price">&#8377;{{ cart_item.product.price }}</td>
                                        {% endif %}
                                        




                                             {% comment %} <td class="product_quantity"><label></label> <input min="1"
                                                    max="100" value="{{ cart_item.quantity }}" type="number"></td> {% endcomment %}

                                                    <td class="product_quantity">
                                                       {% comment %} <label>{{ cart_item.quantity }}</label> {% endcomment %}
                                                       <label id="quantity-label-{{ cart_item.id }}">{{ cart_item.quantity }}</label>
                                                        
                                                        <div class="quantity-buttons">
                                                            {% comment %} <a href="{% url 'increment_quantity' cart_item.id %}" class="quantity-button">+</a> {% endcomment %}
                                                            {% comment %} <a href="{% url 'decrement_quantity' cart_item.id %}" class="quantity-button">-</a> {% endcomment %}
                                                            <a href="#" class="quantity-button increment-btn" data-cart-item-id="{{ cart_item.id }}">+</a>
                                                            <a href="#" class="quantity-button decrement-btn" data-cart-item-id="{{ cart_item.id }}">-</a>
                                                          </div> 
                                                          
                                                          


                                                    </td>  


                                                    
                                            <td class="product_total" id="cart-item-price-{{ cart_item.id }}">&#8377;{{ cart_item.get_product_price }}</td>
                                        </tr> <!-- End Cart Single Item-->
                                        <!-- Start Cart Single Item-->
                                        
                                        <!-- Start Cart Single Item-->
                                        
                                        <!-- End Cart Single Item-->
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            <div class="cart_submit">
                                {% comment %} <button class="btn btn-md btn-golden" type="submit">update cart</button> {% endcomment %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- End Cart Table -->

        {% comment %} <!-- Start Coupon Start -->
        <div class="coupon_area">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6 col-md-6">
                        <div class="coupon_code left" data-aos="fade-up" data-aos-delay="200">
                            <h3>Coupon</h3>
                            
                            <form method="POST">
                                {% csrf_token %}
                            <div class="coupon_inner">
                                <p>Enter your coupon code if you have one.</p>
                                <input class="mb-2" name="coupon" placeholder="Coupon code" type="text">
                                <button type="submit" class="btn btn-md btn-golden">Apply coupon</button>

                                {% if cart_obj.coupon %}
                            
                            
                        </form>
                        <div>
                            <p>Applied coupons</p>
                            <a href = "{% url 'remove_coupon' cart_obj.id %}"class='btn btn-md btn-golden'>{{cart_obj.coupon.coupon_code}}</a>
                            {% endif %}
                            </div>
                        </div>
                      
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6">
                        <div class="coupon_code right" data-aos="fade-up" data-aos-delay="400">
                            <h3>Cart Totals</h3>
                            <div class="coupon_inner">
                                {% comment %} <div class="cart_subtotal">
                                    <p>Subtotal</p>
                                    <p class="cart_amount">$215.00</p>
                                </div>
                                <div class="cart_subtotal ">
                                    <p>Shipping</p>
                                    <p class="cart_amount"><span>Flat Rate:</span> $255.00</p>
                                </div>
                                <a href="#">Calculate shipping</a> 

                                <div class="cart_subtotal">
                                    <p>Total</p>
                                    <p class="cart_amount">${{ cart_obj.get_cart_total }}</p>
                                </div>
                                <div class="checkout_btn">
                                    <a href="{% url 'checkout' %}" class="btn btn-md btn-golden">Proceed to Checkout</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- End Coupon Start -->

{% endcomment %}

      <!-- Start Coupon Area -->
<div class="coupon_area">
  <div class="container">
    <div class="row">
      <div class="col-lg-6 col-md-6">
        <div class="coupon_code left" data-aos="fade-up" data-aos-delay="200">
          <h3>Coupon</h3>
          <form method="POST">
            {% csrf_token %}
            <div class="coupon_inner">
              <p>Enter your coupon code if you have one.</p>
              <input class="mb-2" name="coupon" placeholder="Coupon code" type="text">
              <button type="submit" class="btn btn-md btn-golden">Apply coupon</button>
              
              <!-- Button trigger modal for Available Coupons-->
            <button type="button" class="btn btn-md btn-golden" data-bs-toggle="modal" data-bs-target="#exampleModal">
                Coupons Available
                </button>


                <!-- Modal for Available Coupons-->
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Your coupons.</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          {% for coupon in coupons %}
                            <div class="coupon1">
                                <div class="container1">
                                </div>
                                <div class="container1" style="background-color:white">
                                  <h2><b>&#8377; {{coupon.discount_price}} OFF ON YOUR PURCHASE.</b></h2>
                                  <p>Apply this coupon to get &#8377; {{coupon.discount_price}} discount on your order.</p>
                                </div>
                                <div class="container1">
                                  <p>Use Coupon Code: <span class="promo1">{{coupon.coupon_code}}</span></p>
                                  <p>Minimum purchase amount : <span class="promo1">&#8377; {{coupon.minimum_amount}}</span></p>
                                  {% if coupon.is_expired %}
                                  <p class="expire1">Validity:Expired
                                    {% else %}
                                  <p class="expire2">Validity:Active
                                    {% endif %}</p>
                                </div>
                              </div>
                              {% endfor %}


                        </div>
                        <div class="modal-footer">
                        <button type="button" class="btn btn-black-default-hover" data-bs-dismiss="modal">Close</button>
                        
                        </div>
                    </div>
                    </div>
                </div>


            </div>
          </form>
          {% if cart_obj.coupon %}
            <div class="coupon_inner">
              <p>Applied coupons</p>
              <a href="{% url 'remove_coupon' cart_obj.id %}" class="btn btn-block btn-lg btn-black-default-hover">{{ cart_obj.coupon.coupon_code }}</a>
            </div>
          {% endif %}
        </div>
      </div>
      <div class="col-lg-6 col-md-6">
        <div class="coupon_code right" data-aos="fade-up" data-aos-delay="400">
          <h3>Cart Totals</h3>
          <div class="coupon_inner">
            <!-- <div class="cart_subtotal">
              <p>Subtotal</p>
              <p class="cart_amount">$215.00</p>
            </div>
            <div class="cart_subtotal">
              <p>Shipping</p>
              <p class="cart_amount"><span>Flat Rate:</span> $255.00</p>
            </div>
            <a href="#">Calculate shipping</a> -->

            <div class="cart_subtotal">
              <p>Total</p>
              {% comment %} <p class="cart_amount">&#8377;{{ cart_obj.get_cart_total }}</p> {% endcomment %}
              <p class="cart_amount">&#8377;<span id="cart-total">{{ cart_obj.get_cart_total }}</span></p>
            </div>
            <div class="checkout_btn">
              <a href="{% url 'checkout' %}" class="btn btn-md btn-golden">Proceed to Checkout</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- End Coupon Area -->






    </div> <!-- ...:::: End Cart Section:::... --> 
    {% else %}



<!-- ...::::Start About Us Center Section:::... -->
<div class="empty-cart-section section-fluid">
    <div class="emptycart-wrapper">
        <div class="container">
            <div class="row">
                <div class="col-12 col-md-10 offset-md-1 col-xl-6 offset-xl-3">
                    <div class="emptycart-content text-center">
                        <div class="image">
                            <img class="img-fluid" src="assets/images/emprt-cart/empty-cart.png" alt="">
                        </div>
                        <h4 class="title">Your Cart is Empty</h4>
                        <h6 class="sub-title">Sorry Mate... No item Found inside your cart!</h6>
                        <a href="{% url 'shop' %}" class="btn btn-lg btn-golden">Continue Shopping</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> <!-- ...::::End  About Us Center Section:::... -->

{% endif %}



<script>
  $(document).ready(function() {
      // Increment button click
      $('.increment-btn').on('click', function(e) {
          e.preventDefault();
          var cartItemId = $(this).data('cart-item-id');
          $.ajax({
              type: "GET",
              url: "{% url 'increment_quantity' 0 %}".replace('0', cartItemId),
              success: function(response) {
                  // Update the quantity label
                  $('#quantity-label-' + cartItemId).text(response.quantity);
                  // Update the cart total
                  $('#cart-total').text(response.cart_total);
                  // Update the cartitem price
                  $('#cart-item-price-'+ cartItemId).text('₹' + response.item_price);
                  
              },
              error: function(response) {
                // Use SweetAlert2 to display the error message
                Swal.fire({
                  title: "Error",
                  text: response.responseJSON.error,
                  icon: "error",
              });
              }
          });
      });

      // Decrement button click
      $('.decrement-btn').on('click', function(e) {
          e.preventDefault();
          var cartItemId = $(this).data('cart-item-id');
          $.ajax({
              type: "GET",
              url: "{% url 'decrement_quantity' 0 %}".replace('0', cartItemId),
              success: function(response) {
                  // Update the quantity label
                  $('#quantity-label-' + cartItemId).text(response.quantity);
                  // Update the cart total
                  $('#cart-total').text(response.cart_total);
                  // Update the cartitem price
                  $('#cart-item-price-'+ cartItemId).text('₹' + response.item_price);
              },
              error: function(response) {
                Swal.fire({
                  title: "Error",
                  text: response.responseJSON.error,
                  icon: "error",
              });
              }
          });
      });
  });
</script>





    {% endblock %}


{% block scripts %}
{% include 'includes/messages.html' %}
{% endblock scripts %}   {% endcomment %}

{% comment %} ------------------------------------------------------------------------------------------------------- {% endcomment %}
{% extends 'base.html' %}
{% block content%}


<main>
    <!-- Hero Area Start-->
    <div class="slider-area ">
        <div class="single-slider slider-height2 d-flex align-items-center">
            <div class="container">
                <div class="row">
                    <div class="col-xl-12">
                        <div class="hero-cap text-center">
                            <h2>Cart List</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--================Cart Area =================-->
    <section class="cart_area section_padding">
      <div class="container">
{% if not cart_items %}
<h2 class="text-center">YOUR SHOPING CART IS EMPTY</h2>
<br>
<div class="text-center">
  <a href="{% url 'product_display'%}"  class="btn btn-primary">CONTINUE SHOPING</a>
</div>
{% else %}
        <div class="cart_inner">
          <div class="table-responsive">
            <table class="table">
              <thead>
                {% for message in messages %}
              
                                  <div class="alert alert-warning alert-dismissible fade show" role="alert">
                                      {{ message }}
                                      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                      </button>
                                    </div>
                  {% endfor %}
                <tr>
                  <th scope="col"style="color: #333;">Product</th>
                  <th scope="col"style="color: #333;">Price</th>
                  <th scope="col"style="color: #333;">colour</th>
                  <th scope="col"style="color: #333;">Quantity</th>
                  <th scope="col"style="color: #333;">SubTotal</th>
                  <th scope="col"style="color: #333;"></th>
                </tr>
              </thead>
              <tbody>
                {% for cart_item in cart_items%}
                 <tr>
                  <td>
                    <div class="media">
                      <div class="d-flex">
                        <img src="{{ cart_item.product.image1.url}}" alt="" />
                      </div>
                      <div class="media-body">
                   <a href="{%url 'single_view' product_id=cart_item.product.id %}" ><p>{{cart_item.product.product_name}}</p></a>
                      </div>
                    </div>
                  </td>
                  <td>
                    <h5>{{cart_item.variation.price}}</h5>
                  </td>
                  <td>
                    <h5>{{cart_item.variation.colour}}</h5>
                  </td>




                  <td>
                    <div class="product_count">
                    
                       <span class="input-number-decrement link-like"> <a href="{% url 'remove_cart' cart_item.variation.id %}"> <i class="ti-minus"></i></a></span>
                      <input class="input-number" type="text" value={{ cart_item.quandity }} >
                      <span class="input-number-increment">
                        <a href="{%url 'adding_cart' cart_item.variation.id %}">
                            <i class="ti-plus"></i>
                        </a>
                      </span> 
                     
                      
                   </div>
                  </td>
                   

                  {% if cart_item.product.offerr %}
						      <td >{{ cart_item.sub_total_with_offer}}</td>
                  {% elif cart_item.product.cateogary.offerr %}
						        <td>{{ cart_item.sub_total_with_offer_category }}</td>
                  {% else %}
                  <td>{{sub_total}}</td>
                  {% endif %}
                  <td>
                 <a class="btn_1" href="{% url 'remove_cart_item' cart_item.variation.id %}">remove</a>
                  </td> 
                 </tr>
                {% endfor %}
                <tr>
                  <td></td>
                  <td></td>
                  <div class="col-lg-6 col-md-6">
                    <div class="coupon_code left" data-aos="fade-up" data-aos-delay="200">
                        <h3>Coupon</h3>
                        
                    <form method="POST">
                            {% csrf_token %}
                        <div class="coupon_inner">
                            <p>Enter your coupon code if you have one.</p>
                            <input class="mb-2" name="coupon" placeholder="Coupon code" type="text">

                            <button type="submit" class="btn btn-md btn-golden">Apply coupon</button>
                             <br> 
                            <br>
                        </div> 
                    </form>      
                </div>
                <button type="button" class="btn_1" data-bs-toggle="modal" data-bs-target="#coupon">
                  Coupons
                </button>

                     <!-- Modal -->
                <div class="modal fade" id="coupon" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Available Coupons</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      
                    {% for i in coupons %}
                       <div class="card text-bg-warning mb-3" style="max-width: 15rem;">
                        <div class="card-header">CODE :{{i.code}} </div>
                        <div class="card-body">
                          <h5 class="card-title">Copy the code for use</h5>
                          <p class="card-text">{{i.discout_price}} Rupees off on the purchase above{{i.minimum_amount}}</p>
                        </div>
                      </div>
                      {% endfor %}
                    
                    </div>
                    <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                    </div> 
                  </div>
                  </div>
                </div>
                <td>
                    <h5 style="color: #333;">TOTAL PRICE</h5>
                  </td>
                  <td>
                    <h5 id= "cart-item-price-" style="color: #444;">{{total }}</h5>
                  </td>
                </tr>
                </tr>
              </tbody>
            </table>
            <div class="checkout_btn_inner float-left">
              <a class="btn_1" href="{% url 'product_display' %}">Continue Shopping</a>
            </div>
            <div class="checkout_btn_inner float-right">
              <a class="btn_1 checkout_btn_1" href="{%url 'checkout' %}">Proceed to checkout</a>
            </div>
          </div>
        </div>
{% endif %}        
    </section>
 
 </main>


 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

{% endblock content %}

 




